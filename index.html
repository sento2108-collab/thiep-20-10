<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªùi Ch√∫c ƒê·∫∑c Bi·ªát - T√≠ch h·ª£p GIF</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <style>
        /* ======================================= */
        /* 1. CSS CHUNG V√Ä M√ÄN H√åNH B·∫ÆT ƒê·∫¶U (STAR) */
        /* ======================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            /* N·ªÅn B·∫ßu tr·ªùi ƒë√™m thay v√¨ H·ªìng */
            background: linear-gradient(180deg, #1A237E, #303F9F, #5C6BC0);
            background-size: 400% 400%;
            animation: gradientFlow 12s ease infinite;
            overflow: hidden;
            position: relative;
        }

        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* M√†n h√¨nh B·∫Øt ƒë·∫ßu (Thay th·∫ø #rose-t) */
        .container.new-start-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            cursor: pointer;
        }

        /* GIF Ng√¥i sao (Thay th·∫ø fa-star) */
        .star-gif {
            width: 180px; 
            height: 180px;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
        }

        .click-text {
            font-family: 'fantasy', cursive;
            color: #ADD8E6;
            font-size: 30px;
            margin-top: 30px;
            opacity: 0; /* B·∫Øt ƒë·∫ßu ·∫©n, s·∫Ω hi·ªán sau 4s b·∫±ng JS */
            animation: flicker 1.5s infinite alternate;
            transition: opacity 0.5s;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* ========================================== */
        /* 2. CSS M√ÄN H√åNH CHUY·ªÇN TI·∫æP (L√ÉNG HOA & SVG)*/
        /* ========================================== */

        #theSvg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }
        
        #flower-basket {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
        }

        .basket-shadow {
            position: absolute;
            width: 250px;
            height: 15px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            bottom: 10vh;
            animation: scaleShadow 3s linear infinite;
        }

        @keyframes scaleShadow {
            0%, 100% { transform: scaleX(1); }
            50% { transform: scaleX(0.8); }
        }

        .basket-container {
            position: relative;
            width: 280px;
            height: 400px; /* ƒêi·ªÅu ch·ªânh ƒë·ªÉ ch·ª©a GIF hoa */
            animation-duration: 1.5s;
            cursor: pointer;
        }

        .basket {
            width: 100%;
            height: 100px;
            background-color: #A0522D; /* S√¥ c√¥ la */
            border-radius: 0 0 30px 30px;
            position: absolute;
            bottom: 0;
            border: 5px solid #8B4513;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }

        .basket-text {
            color: white;
            font-family: fantasy;
            font-size: 20px;
        }

        /* GIF Hoa (Thay th·∫ø cho c√°c h√¨nh h·ªçc ph·ª©c t·∫°p) */
        .flower-gif {
            position: absolute;
            width: 100px;
            height: 100px;
            z-index: 10;
            animation: flowerWiggle 4s infinite ease-in-out;
        }
        
        .flower-pos-1 { top: 30px; left: 50%; transform: translateX(-50%); }
        .flower-pos-2 { top: 120px; left: 20px; animation-delay: 1s; }
        .flower-pos-3 { top: 120px; right: 20px; animation-delay: 2s; }
        
        @keyframes flowerWiggle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* ======================================= */
        /* 3. CSS POPUP TH∆Ø (LETTER) */
        /* ======================================= */

        .wrapperLetterForm {
            position: fixed;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            top: 0;
            left: 0;
        }

        /* GIF Confetti */
        .confetti-gif {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 9999; 
            opacity: 0.8;
            pointer-events: none;
        }

        .boxLetter {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .formLetter {
            position: relative;
            width: 700px;
            max-width: 90%;
            min-height: 400px;
            background-color: #FFFFFF;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 40px rgba(255, 105, 180, 0.7); 
            border: 5px solid #FF69B4;
            z-index: 10001; /* ƒê·∫£m b·∫£o tr√™n confetti */
            transform: scale(0.9);
            animation: openScale 0.5s forwards;
        }
        
        @keyframes openScale {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .formLetter .heartLetter { display: none; } /* ·∫®n chi ti·∫øt c≈© */

        .textLetter h2 {
            font-family: 'Georgia', serif;
            font-size: 36px;
            color: #FF69B4;
            margin-bottom: 20px;
            text-align: center;
        }

        .textLetter .contentLetter {
            font-family: 'Times New Roman', serif;
            font-size: 20px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }

        .fa-xmark {
            position: absolute;
            color: white;
            font-size: 30px;
            right: 15px;
            top: 15px;
            cursor: pointer;
            z-index: 10002;
        }

    </style>
</head>
<body>

    <svg style="display: none;" id="theSvg" viewBox="-120 -30 240 180" enable-background="new 0 0 174 148"
        xml:space="preserve">
        <defs>
            <filter id="f" filterUnits="userSpaceOnUse" x="-120" y="-30" width="120%" height="120%">
                <feGaussianBlur in="SourceAlpha" stdDeviation="5" result="blur"></feGaussianBlur>
                <feOffset in="blur" dx="3" dy="5" result="shadow"></feOffset>
                <feFlood flood-color="rgba(3,0,0,1)" result="color" />
                <feComposite in="color" in2="shadow" operator="in" />
                <feComposite in="SourceGraphic" />
            </filter>
            <path id="shape" d="M0, 21.054 C0, 21.054 24.618, -15.165 60.750, 8.554 C93.249, 29.888 57.749, 96.888 0, 117.388 C-57.749, 96.888 -93.249, 29.888 -60.750, 8.554 C-24.618, -15.165 -0, 21.054 -0, 21.054z" />
            <path id="partialPath" />
        </defs>

        <text dy="-2">
            <textPath style="font-family: fantasy;" xlink:href="#partialPath" startOffset="12">
                üåπHappy Women's Day
                üåπ.........................................................................................................................................üåπFrom
                With Love 20/10!üåπ
            </textPath>
        </text>

        <use id="useThePath" xlink:href="#partialPath" stroke="white" stroke-width=".5" stroke-opacity=".5" fill="none"
            style="display:none;" />
    </svg>
    <div class="container new-start-screen" id="star-t">
        <img src="./image/sparkle.gif" alt="Sparkling Star" class="star-gif"> 
        <p id="text-click" class="click-text">‚ú® Touch The Star ‚ú®</p>
    </div>


    <div id="flower-basket" style="display: none;">
        <div class="basket-shadow"></div>
        <div class="basket-container animate__animated animate__fadeInUp" onclick="openLetter()">
            <img src="./image/flower_float.gif" alt="Floating Flower" class="flower-gif flower-pos-1">
            <img src="./image/flower_float.gif" alt="Floating Flower" class="flower-gif flower-pos-2">
            <img src="./image/flower_float.gif" alt="Floating Flower" class="flower-gif flower-pos-3">
            
            <div class="basket">
                <p class="basket-text">Your Gift!</p>
            </div>
        </div>
    </div>


    <div class="wrapperLetterForm" style="display: none;" id="letter-popup">
        <img src="./image/confetti.gif" alt="Confetti" class="confetti-gif">

        <div class="boxLetter">
            <i class="fa-solid fa-xmark" onclick="closeLetter()"></i>
            <div class="formLetter">
                <div class="wrapperLetter">
                    <div class="textLetter">
                        <h2>G·ª≠i t·∫∑ng ng∆∞·ªùi ph·ª• n·ªØ tuy·ªát v·ªùi!</h2>
                        <p class="contentLetter">
                            Nh√¢n ng√†y Ph·ª• N·ªØ, ch√∫c b·∫°n lu√¥n xinh ƒë·∫πp, t·ª± tin v√† to·∫£ s√°ng r·ª±c r·ª° nh∆∞ nh·ªØng v√¨ sao tr√™n b·∫ßu
                            tr·ªùi. M√≥n qu√† nh·ªè n√†y l√† l·ªùi c·∫£m ∆°n ch√¢n th√†nh nh·∫•t v√¨ t·∫•t c·∫£ nh·ªØng ƒëi·ªÅu tuy·ªát v·ªùi b·∫°n ƒë√£ mang
                            l·∫°i!
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>

    <script>
        // C√°c bi·∫øn to√†n c·ª•c cho ho·∫°t ·∫£nh SVG (GI·ªÆ NGUY√äN)
        var shape = document.querySelector("#shape");
        var partialPath = document.querySelector("#partialPath");
        var pathlength = shape.getTotalLength();
        var num = 100;
        var subpaths = [];
        var t = 0;
        var rid = null;

        // H√†m t√≠nh to√°n v√† v·∫Ω ƒë∆∞·ªùng cong B√©zier (GI·ªÆ NGUY√äN LOGIC TO√ÅN H·ªåC)
        function subPath(shape, T) {
            var path = shape.getAttribute("d");
            if (path == null || path.length < 5) return null;
            // Chuy·ªÉn chu·ªói path d sang ƒë·ªëi t∆∞·ª£ng PathSegments
            var segments = PathSegments.parse(path);
            var lastCubicBezier = segments.lastCubicBezier();
            segments.lastCubicBezier(lastCubicBezier.subpath(T));
            var subpath = segments.toString();
            return {
                path: subpath,
                pathLength: segments.getLength(),
                lastCubicBezier: lastCubicBezier
            };
        }

        // T·∫°o c√°c ƒëi·ªÉm ki·ªÉm so√°t cho t·ª´ng ƒëo·∫°n path (GI·ªÆ NGUY√äN)
        for (var i = 0; i < num; i++) {
            subpaths.push(subPath(shape, (i + 1) / num));
        }

        function lerp(a, b, T) {
            return (1 - T) * a + T * b;
        }

        function getBezierPoints(T, p) {
            var p0 = [lerp(p[0][0], p[1][0], T), lerp(p[0][1], p[1][1], T)];
            var p1 = [lerp(p[1][0], p[2][0], T), lerp(p[1][1], p[2][1], T)];
            var p2 = [lerp(p[2][0], p[3][0], T), lerp(p[2][1], p[3][1], T)];
            var p01 = [lerp(p0[0], p1[0], T), lerp(p0[1], p1[1], T)];
            var p12 = [lerp(p1[0], p2[0], T), lerp(p1[1], p2[1], T)];
            var p012 = [lerp(p01[0], p12[0], T), lerp(p01[1], p12[1], T)];
            return {
                p0: p0,
                p1: p1,
                p2: p2,
                p01: p01,
                p12: p12,
                p012: p012,
            };
        }

        function drawCBezier(newPoints, partialPath, index) {
            partialPath.setAttribute("d", subpaths[index].path);
        }

        function get_T(t, index) {
            return (t * pathlength - (index > 0 ? subpaths[index - 1].pathLength : 0)) /
                (subpaths[index].pathLength - (index > 0 ? subpaths[index - 1].pathLength : 0));
        }
        
        // --- LOGIC GIAO DI·ªÜN M·ªöI ---
        
        function openLetter() {
            // Hi·ªÉn th·ªã Confetti v√† Popup th∆∞
            document.getElementById('letter-popup').style.display = 'flex';
        }

        function closeLetter() {
            document.getElementById('letter-popup').style.display = 'none';
        }

        (() => {
            // 1. Logic b·∫Øt ƒë·∫ßu: Hi·ªán th√¥ng b√°o click sau 4s
            setTimeout(() => {
                document.querySelector("#text-click").style.opacity = "1";
            }, 4000);

            // 2. Logic chuy·ªÉn m√†n h√¨nh khi click Ng√¥i sao
            document.querySelector("#star-t").onclick = function () {
                // ·∫®n m√†n h√¨nh ng√¥i sao
                document.querySelector("#star-t").style.display = "none";
                
                // Hi·ªÉn th·ªã m√†n h√¨nh l·∫µng hoa v√† SVG
                document.querySelector("#flower-basket").style.display = "flex";
                document.querySelector("#theSvg").style.display = "inherit";

                // B·∫Øt ƒë·∫ßu ho·∫°t ·∫£nh vi·∫øt ch·ªØ SVG (Gi·ªØ nguy√™n logic Typing)
                rid = window.requestAnimationFrame(Typing);
                
                function Typing() {
                    rid = window.requestAnimationFrame(Typing);
                    if (t >= 1) {
                        window.cancelAnimationFrame(rid);
                        rid = null;
                        
                        // Ho·∫°t ·∫£nh k·∫øt th√∫c: l√†m cho ch·ªØ lung linh
                        anime({
                            targets: '#theSvg text',
                            fill: ['rgba(255, 255, 255, 0.5)', 'rgba(255, 255, 255, 1)'],
                            filter: ['drop-shadow(0 0 5px #FFF)', 'drop-shadow(0 0 15px #FFD700)'],
                            loop: true,
                            direction: 'alternate',
                            easing: 'easeInOutQuad',
                            duration: 1000
                        });
                        
                    } else {
                        t += 0.0025; // T·ªëc ƒë·ªô vi·∫øt ch·ªØ
                    }

                    // To√†n b·ªô logic to√°n h·ªçc B√©zier gi·ªØ nguy√™n
                    lengthAtT = pathlength * t;
                    for (index = 0; index < subpaths.length; index++) {
                        if (subpaths[index].pathLength >= lengthAtT) {
                            break;
                        }
                    }
                    T = get_T(t, index);
                    newPoints = getBezierPoints(T, subpaths[index].lastCubicBezier);
                    drawCBezier(newPoints, partialPath, index);
                }
            }
        })();
    </script>
    <script src="https://cdn.jsdelivr.net/gh/Dmitry-Dedov/PathSegments@master/dist/pathsegments.min.js"></script>
</body>
</html>
